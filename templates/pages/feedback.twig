{% extends 'main.twig' %}
{% block content %}
<!-- Feedback Form Section -->
<section id="feedback" class="py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-6">
                <div class="card shadow border-0">
                    <div class="card-body p-5">
                        <h2 class="text-center mb-4">We Value Your Feedback</h2>
                        <p class="text-center mb-4 text-muted">
                            Your thoughts and suggestions help us improve our city guide. Please take a moment to
                            provide your feedback below.
                        </p>
                        <form id="feedbackForm">
                            <!-- Name Input -->
                            <div class="form-group mb-3">
                                <label for="name">Name</label>
                                <input type="text" class="form-control" id="name" placeholder="Enter your name"
                                    required>
                            </div>

                            <!-- Email Input -->
                            <div class="form-group mb-3">
                                <label for="email">Email address</label>
                                <input type="email" class="form-control" id="email" placeholder="Enter your email"
                                    required>
                            </div>

                            <!-- Rating Input -->
                            <div class="form-group mb-3">
                                <label for="rating">Rate Us</label>
                                <select class="form-select form-control" id="rating" required>
                                    <option selected disabled>Choose a rating</option>
                                    <option value="5">Excellent</option>
                                    <option value="4">Very Good</option>
                                    <option value="3">Good</option>
                                    <option value="2">Fair</option>
                                    <option value="1">Poor</option>
                                </select>
                            </div>

                            <!-- Comments Input -->
                            <div class="form-group mb-4">
                                <label for="comments">Your Feedback</label>
                                <textarea class="form-control" id="comments" rows="4"
                                    placeholder="Write your feedback here..." required></textarea>
                            </div>

                            <!-- Submit Button -->
                            <div class="d-grid">
                                <button type="submit" class="btn btn-danger btn-block">Submit Feedback</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Fetch API to Send Form Data -->
<script>
    document.getElementById('feedbackForm').addEventListener('submit', function (event) {
        event.preventDefault();
        const token = localStorage.getItem('access_token');

        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const rating = document.getElementById('rating').value;
        const comments = document.getElementById('comments').value;

        const data = {
            name: name,
            email: email,
            rating: rating,
            comments: comments,
        };

        fetch(`{{api_host}}/api/feedback/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(data)
        })
            .then(response => response.json())
            .then(data => {
                alert('Feedback submitted successfully!');
                console.log('Success:', data);
            })
            .catch((error) => {
                console.error('Error:', error);
            });
    });
</script>

{% endblock content %}
